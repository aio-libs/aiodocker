sudo: required

language: python

python:
  - "3.5"
  - "3.6"

env:
  - DOCKER_VERSION=17.03
  - DOCKER_VERSION=17.04
  - DOCKER_VERSION=17.05
  - DOCKER_VERSION=17.06

services:
  - docker

install:
  - docker run -d --privileged --net host --name ci-docker docker:$DOCKER_VERSION-dind dockerd -H tcp://localhost:27015
  - docker run -d --name registry -p 5000:5000 registry
  - pip install -r requirements/ci.txt

script:
  - python setup.py check -rms
  - DOCKER_HOST=tcp://localhost:27015 tox

after_success:
  - codecov
