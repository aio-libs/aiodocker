Add more type annotations to the core APIs and retire codes for Python 3.7 compatibility
